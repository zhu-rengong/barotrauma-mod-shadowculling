> **AI 生成内容说明**：本文档由人工智能对用户提供的原始技术描述进行整理、润色与结构化重组而成，旨在提升内容的专业性与可读性。

# 二维视点动态阴影剔除算法

## 1. 核心原理
**目标**：快速判断并剔除位于阴影区内、完全不可见的物体。

### 1.1 核心定义
- **遮挡线 (Occluder)**：场景中可投射阴影的结构所定义的一条线段。它是视线的阻挡边界。
- **阴影区 (Shadow)**：从**视点**向遮挡线两端引射线所构成的**无界楔形区域**，此区域内物体理论上不可见。
- **物体表示**：每个物体的所有精灵由一个**轴对齐包围盒 (AABB)** 界定。

### 1.2 剔除逻辑
判断物体的AABB是否完全位于任一阴影区内。若是，则剔除。

**具体步骤**：
1. **测试简化**：将AABB与无界楔形的测试，转化为对其**四条边缘**的测试。
2. **可见性判定**：
   - 若任意一条边未被完全遮挡 → 物体可见（保留）。
   - 若所有边均被完全遮挡 → 物体不可见（剔除）。
3. **线段遮挡测试**：通过几何裁剪算法（如`ClipFrom`）判断单条线段是否完全位于阴影区内。

> 注：基础算法需配合优化策略，否则计算开销可能超过收益。

## 2. 关键优化策略

### 2.1 空间分区
- 对阴影区和物体AABB进行**象限/网格划分**。
- 先快速判断空间区域是否有交集，无则跳过所有后续计算。

### 2.2 阴影区优先级与级联剔除
- **优先处理近处阴影区**。
- 若一个遮挡线完全位于另一个（更近的）阴影区内，则判定为冗余，可忽略。

### 2.3 自适应频率与运动预测
- 不每帧全量计算，降低剔除频率。
- 持续追踪视点与遮挡体的运动，并**预测阴影区边界变化**：
  - 若预测边界**扩大** → 采用严格判定，无容忍度。
  - 若预测边界**收缩** → 为判定设置容忍度，避免物体“贴脸加载”的视觉瑕疵。

### 2.4 基于象限的边缘测试简化
- 根据AABB相对于视点所在的象限，推断最可能被遮挡的边缘。
- **示例规则**：若AABB位于视点左上方或右上方（第一、二象限），则**仅需测试AABB的下边缘**。若下边缘完全不可见，则整个AABB不可见，无需测试其余三边。

### 2.5 基于船壳 (Hull) 的批量预剔除
- **Hull**：一种自定义空间分区结构，可将一组相关物体（如一房间内的摆设）包裹在一个更大的包围体内。
- **批量逻辑**：
  1. 若Hull**完全位于**阴影区内 → 其内部**所有物体被批量剔除**，无需逐个测试。
  2. 若Hull与阴影区**相交或在外** → 需对其内部物体进行逐AABB测试。
- **优势**：用一次Hull测试替代多次物体测试，显著提升对静态密集区域的剔除效率。划分粒度需在性能与精度间权衡。